#!/usr/bin/env node
var pg = require('pg')
pg.defaults.ssl = true

console.log('AN event retrieval script started.');
var event_campaign_id = process.env.event_campaign_id
var an_api_token = process.env.an_api_token
var event_table_name = 'events_' + event_campaign_id
console.log(process.env.DATABASE_URL)
console.log('Looking for table',event_table_name)

pg.connect(process.env.DATABASE_URL, function(err, client) {
  if (err) throw err
  console.log('Connected to postgres! Getting schemas...')
  client
    .on('notice', function(msg) {
      console.log("notice: %j", msg);
    })
    .on('error', function(error){
      console.error(error)
    })

  client
    .query(`CREATE TABLE IF NOT EXISTS ${event_table_name}( state TEXT, event TEXT );`)

  var query_string = `SELECT * FROM information_schema.tables WHERE table_name='${event_table_name}';`
  client.query(query_string).on('row', function(row) {
    console.log(JSON.stringify(row));
  })

});
